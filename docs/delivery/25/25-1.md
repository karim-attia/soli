# 25-1 Calibrate CardVisual proportions

[Back to task list](./tasks.md)

## Description
Capture the connected phone’s exact `CardMetrics`, document the reference measurement, then refactor `CardVisual` so that ranks and suits scale from those measured ratios instead of hard-coded pixel values. Remove the temporary logging once the calibration snapshot is recorded to avoid polluting future logs.

## Status History
| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2025-11-14 11:05:10 | Created | N/A | Proposed | Documented calibration implementation scope and requirements. | ai_agent |
| 2025-11-14 11:05:40 | Status Change | Proposed | Agreed | User approved calibration task. | user |
| 2025-11-14 11:06:10 | Status Change | Agreed | InProgress | Began adding telemetry and proportional layout changes. | ai_agent |

## Requirements
- Record the connected phone measurement (48×68 card, stack offset 24, radius 6) and remove the developer log hook afterward.
- Persist the last known board width/height via AsyncStorage so the initial render uses calibrated metrics instead of the placeholder defaults.
- Coordinate with the user for any future demo auto-solve runs instead of executing `yarn demo:auto-solve` locally.
- Translate card padding, font sizes, and offsets into ratio-based calculations so any `CardMetrics` reproduce the reference proportions.
- Keep Tamagui `Text` usage and animation integration unchanged to avoid regressions.

## Implementation Plan
- Temporarily add a helper inside `CardView.tsx` that uses `devLog` to print the resolved styles once per session, then strip it once the snapshot is captured.
- Request the user’s assistance to run the demo build on device and share the resulting logs, avoiding local installs.
- Introduce reference measurement constants derived from the captured width/height and calculate multipliers (e.g., font size, offsets) as percentages of that base measurement.
- Store board layout metrics with AsyncStorage (mirroring the pattern used by settings) and hydrate them when the Klondike screen mounts to avoid the initial layout jump.
- Replace static `styles.cardCornerRank`, `styles.cardCornerSuit`, and `styles.cardSymbol` usage with computed styles inside `CardVisual` while keeping the base container style definitions.
- Validate via story/test build that cards look identical in the simulator and that no additional developer logs appear.

## Test Plan
- Verify the resulting ratios compute the same absolute pixel values as the captured measurements when `metrics` matches the reference width/height.
- Spot-check multiple card sizes (tableau vs. waste) to ensure the ratios scale correctly without clipping.
- Confirm that a cold launch reuses the persisted board metrics and avoids the initial jump (by comparing before/after logs or visual capture).
- Ensure TypeScript compilation remains clean (`yarn tsc --noEmit`).

## Verification
- Pending end-to-end confirmation in Task 25-2 after proportional styles are implemented and the user shares device logs.

## Files Modified
- `docs/delivery/backlog.md`
- `docs/delivery/25/prd.md`
- `docs/delivery/25/tasks.md`
- `docs/delivery/25/25-1.md`
- `docs/delivery/25/25-2.md`
- `src/features/klondike/components/cards/CardView.tsx`
- `src/features/klondike/components/cards/styles.ts`

