[Back to task list](./tasks.md)

# 26-4 Automated flight verification

## Description
Instrument the flight controller with telemetry needed for automated checks and add tests that exercise every source/target flight combination. Ensure both unit tests and Detox (or equivalent) end-to-end flows can assert that flights render via the overlay host and complete without regressions.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
| :-- | :-- | :-- | :-- | :-- | :-- |
| 2025-11-23 11:08:00 | Created | N/A | Proposed | Task created after research to build automated verification for overlay layering. | ai_agent |

## Requirements
- Emit `flightStarted` / `flightCompleted` events (or similar) with `{ cardId, sourcePile, targetPile, overlayActive }` so tests can subscribe.
- Expand unit tests to cover controller outputs for manual moves, auto-moves, draw, recycle, and undo.
- Add Detox (or Maestro) flows that pause animations mid-flight, capture screenshots, and confirm the overlay card sits above sentinel elements.
- Provide helpers for test environments to toggle the overlay host and instrumentation without affecting production builds.

## Implementation Plan
1. Update `useFlightController` to publish flight lifecycle events via a lightweight debug observer.
2. Add unit tests covering all combinations listed in the research doc, asserting both the emitted metadata and overlay flag.
3. Enhance the test app (or existing Detox harness) with a developer toggle to freeze flights at mid-progress for visual assertions.
4. Capture baseline screenshots per combination and wire them into CI visual regression checks.
5. Document how to run the new tests locally and interpret failures.

## Test Plan
- Automated unit suite validating flight controller events.
- Detox visual checks ensuring overlay host contains the flight card.
- Manual spot check: run the test harness and verify overlay toggles do not ship in production builds.

## Verification
- CI run shows green results for the new unit and Detox suites.
- Visual diffs demonstrate flights rendered above sentinel overlays.

## Files Modified
- `docs/delivery/26/26-4.md`
- Expected runtime/test files: `src/animation/flightController.ts`, flight-related hooks, new test utilities, Detox spec files, documentation.


