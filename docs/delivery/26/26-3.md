[Back to task list](./tasks.md)

# 26-3 Audit stacking contexts

## Description
Review the Klondike board layout for unintended stacking contexts that could undermine the new flight overlay contract. Adjust styles (`overflow`, `transform`, `opacity`, `zIndex`) on top-row, tableau, statistics HUD, and celebration blockers so that non-overlay children no longer compete with the flight host. Capture the updated layering guidelines in developer documentation.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
| :-- | :-- | :-- | :-- | :-- | :-- |
| 2025-11-23 11:07:00 | Created | N/A | Proposed | Task created from research to audit stacking contexts after overlay adoption. | ai_agent |

## Requirements
- Identify every view under `KlondikeGameView` that sets `overflow`, `transform`, `opacity`, or `zIndex` and document whether it creates a new stacking context.
- Remove or refactor properties that are no longer necessary once flights render in the overlay, keeping visual regressions to zero.
- Define a small set of shared z-order constants for remaining overlays (e.g., undo scrubber, celebration blocker) so future work follows a consistent scale.
- Update the relevant developer guide (or inline comments) with rules for adding new overlays or positioned children.

## Implementation Plan
1. Trace the board render tree (`TopRow`, `StockStack`, `WasteFan`, `FoundationPile`, `TableauSection`, HUD components) and note where stacking-context properties are applied.
2. For each property, decide whether it can be removed, moved to the overlay host, or guarded behind platform checks.
3. Introduce constants describing reserved z-order bands (base piles, HUD, overlays, flights) and replace ad-hoc numeric literals.
4. Verify that existing animations, including celebration overlays, still render correctly after adjustments.
5. Document the layering scale and stacking-context do’s/don’ts in a README or developer note.

## Test Plan
- Manual: Walk through common gameplay sequences (draw, tableau moves, foundation moves, undo, auto-complete) to ensure no visual regressions.
- Manual: Toggle HUD/celebration overlays to confirm they still sit above the board but below flights.
- Regression: Run automated UI snapshot tests (once task 26-4 lands) to ensure layering remains stable.

## Verification
- Visual verification on both platforms.
- Peer review of the documented layering guidelines.

## Files Modified
- `docs/delivery/26/26-3.md`
- Expected runtime files: board layout components (`TopRow`, `TableauSection`, HUD), shared constants, developer documentation.





