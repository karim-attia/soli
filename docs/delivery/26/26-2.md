[Back to task list](./tasks.md)

# 26-2 Implement flight overlay host

## Description
Create a dedicated overlay container for card flight animations so every flight renders above tableau, top-row, and overlay components. Migrate existing `CardView` flight rendering to clone card visuals into the overlay (via Tamagui `Portal` or an absolute positioned host), ensure undo flows return the card to its pile, and keep interactions disabled while a card is in flight.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
| :-- | :-- | :-- | :-- | :-- | :-- |
| 2025-11-23 11:05:00 | Created | N/A | Proposed | Task drafted after research to implement shared flight overlay host. | ai_agent |

## Requirements
- Provide a stable overlay host that sits above board content (e.g., Tamagui `Portal` target or an absolutely positioned container inside `KlondikeGameView`).
- While a flight is active, render the card visual inside the overlay host instead of its pile wrapper, then restore it to the target pile on completion.
- Preserve existing Reanimated timing, card measurement, and undo flows.
- Keep input blocked for the flying card and ensure accessibility focus does not jump unexpectedly.
- Document overlay responsibilities in code comments or developer notes.

## Implementation Plan
1. Introduce an overlay container in `KlondikeGameView` (Portal or absolute `View`) with clear `zIndex` constants.
2. Extend the flight controller to request overlay rendering (e.g., hand out render props or a render queue).
3. Update `CardView` / related components to render a clone into the overlay when `flightZ > 0`, and remove the clone once the animation completes.
4. Verify undo and auto-play flows return cards to the correct pile and detach from the overlay.
5. Add developer logging behind a flag to trace active flights during implementation.

## Test Plan
- Manual: Exercise every flight combination (stock↔waste, tableau↔tableau, tableau↔foundation, undo) and confirm cards always appear above HUD and overlays.
- Manual: Verify touch interactions are blocked on the flying card and re-enabled afterwards.
- Device regression: Run existing animation toggle tests to ensure timings/metrics remain unchanged.

## Verification
- Visual inspection on both iOS and Android simulators/emulators.
- Confirm no new TypeScript or lint warnings arise after the refactor.

## Files Modified
- `docs/delivery/26/26-2.md`
- Expected runtime files: `src/features/klondike/components/KlondikeGameView.tsx`, `src/features/klondike/components/cards/CardView.tsx`, flight controller modules, new overlay helper.

