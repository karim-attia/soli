[Back to task list](./tasks.md)

# [14-5] Evaluate Reanimated 4.2 upgrade + feature flags

## Description
Reanimated 4.2 introduces performance-oriented mechanisms (including feature flags like `FORCE_REACT_RENDER_FOR_SETTLED_ANIMATIONS`) that may reduce animation overhead and improve smoothness. This task evaluates whether upgrading from `react-native-reanimated@~4.1.1` to `~4.2.x` (or newer compatible) and enabling targeted flags is beneficial for this app, and documents a safe recommendation.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
| :-- | :-- | :-- | :-- | :-- | :-- |
| 2025-12-14 11:35:00 | Created | N/A | Proposed | Created task to evaluate Reanimated 4.2 performance improvements and feature flags. | ai_agent |
| 2025-12-14 11:36:00 | Status Change | Proposed | Agreed | User requested analysis of Reanimated 4.2 and recommendations for smoother animations. | user |
| 2025-12-14 12:15:00 | Status Change | Agreed | InProgress | Began researching Reanimated 4.2 guidance and assessing upgrade/flag fit for this app. | ai_agent |
| 2025-12-14 12:25:00 | Status Change | InProgress | Review | Documented Reanimated 4.2 flags + constraints; recommended deferring upgrade until Expo supports 4.2+ (or trial in a dev build). | ai_agent |

## Requirements
- Research Reanimated 4.2 release notes / blog guidance relevant to performance and feature flags.
- Create a cached guide doc for `react-native-reanimated` feature flags and the specific flag(s) under evaluation, including links and date.
- Determine whether upgrading to Reanimated 4.2+ is compatible with the current Expo/RN setup and identify any required rebuild steps.
- Decide whether to enable `FORCE_REACT_RENDER_FOR_SETTLED_ANIMATIONS` and document known behavioural risks (e.g., animated-style detaching semantics).
- Keep the change low-risk: avoid large refactors unless clearly required.

## Implementation Plan
1. Review the linked blog post and official feature-flag docs for Reanimated 4.2.
2. Create `14-5-react-native-reanimated-guide.md` containing the exact references and the key configuration steps.
3. Verify current app versions (Expo 54 / RN 0.81.5 / Reanimated 4.1.1) and assess upgrade path.
4. If safe, upgrade to `react-native-reanimated@~4.2.x`.
5. If recommended, add the static feature flag configuration in `package.json` and document rebuild requirements.

## Test Plan
- Build checks:
  - `yarn tsc --noEmit`
- Manual (device/emulator):
  - Verify draw + flight animations still behave correctly after upgrade.
  - Confirm no new Reanimated warnings/regressions are introduced.

## Verification
- Created `docs/delivery/14/14-5-react-native-reanimated-guide.md` with dated sources and configuration steps.
- Found that Expo SDK 54 currently bundles/pins `react-native-reanimated@~4.1.1`; upgrading to 4.2+ may work in a custom dev client but is outside the standard Expo version matrix.
- Recommendation: keep `~4.1.1` for now; once the project is on Reanimated >= 4.2, trial `FORCE_REACT_RENDER_FOR_SETTLED_ANIMATIONS` in a dev build first and watch for any “animated style detaching” regressions per the docs.

## Files Modified
- `docs/delivery/14/tasks.md`
- `docs/delivery/14/14-5.md`
- `docs/delivery/14/14-5-react-native-reanimated-guide.md`
