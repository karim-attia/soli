# [14-2] Refactor flight animation module with logging

[Back to task list](../tasks.md)

## Description
Extract a dedicated flight animation module that orchestrates all card movements, unifying manual, auto-complete, and celebration flows while emitting structured dev logs for flights and wiggles.

## Status History
| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2025-11-06 10:23:30 | Created | N/A | Proposed | Drafted task to centralize flight animations and logging. | ai_agent |
| 2025-11-06 10:24:00 | Status Change | Proposed | Agreed | User confirmed the refactor scope and logging requirements. | user |
| 2025-11-06 11:05:30 | Status Change | Agreed | InProgress | Began flight animation refactor and logging instrumentation work. | ai_agent |
| 2025-11-06 12:48:00 | Status Change | InProgress | Review | Refactor complete with shared controller, flight logging, and verification runs executed. | ai_agent |

## Requirements
- Move flight orchestration logic into a new module (e.g., `src/animation/flightController.ts`) with a clear API for scheduling moves and emitting events.
- Ensure auto-complete, manual moves, undo, and celebrations all consume the new abstraction.
- Add detailed logging for every flight and wiggle using the shared `devLog` helper, including card id, origin, destination, and trigger context.
- Maintain deterministic sequencing so celebrations begin exactly when the final king reaches a foundation.
- Preserve or improve animation performance and visual smoothness.

## Implementation Plan
1. Identify current flight-related utilities in `app/(tabs)/index.tsx` and supporting hooks, noting entry points for manual moves, auto-complete, undo, and celebration pipelines.
2. Create the new flight controller module exposing methods for registering snapshots, scheduling flights, handling completions, and logging instrumentation.
3. Refactor existing call sites to use the new controller, removing duplicated logic and ensuring consistent timing data.
4. Integrate structured logging by prefixing messages (e.g., `flight:`) via `devLog` with origin/destination metadata for every flight and wiggle.
5. Re-run automation flows (auto-complete, demo mode, celebrations) to verify smooth animations and correct celebration timing.

## Test Plan
- Manual: Execute manual moves, undo/redo sequences, and confirm logs show matching flight entries.
- Manual: Complete a game via auto-complete and verify celebration starts immediately after the last king lands.
- Command: `yarn demo:auto-solve` to review consolidated logs from automated play.
- Automated (if available): Run existing test suites to ensure TypeScript passes and no regressions surface.

## Verification
- `yarn tsc --noEmit` (verified new flight controller compiles cleanly).
- `yarn demo:auto-solve` (validated smooth auto-complete, celebration trigger timing, and inspected `[Flight]`/`[Wiggle]` logs emitted during the run).

## Files Modified
- `docs/delivery/14/14-2.md`
- `docs/delivery/14/tasks.md`
- `docs/delivery/backlog.md`
- `src/animation/flightController.ts` (new)
- `app/(tabs)/index.tsx`
- Related animation utilities (expected)


