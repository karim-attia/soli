# [14-1] Render stacked foundation cards for deterministic flights

[Back to task list](../tasks.md)

## Description
Render every card in each foundation pile so that ongoing animations retain their view references, eliminating flight drops and stray wiggles triggered when the top card unmounts mid-sequence.

## Status History
| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2025-11-06 10:22:00 | Created | N/A | Proposed | Drafted task to keep all foundation cards mounted for deterministic flights. | ai_agent |
| 2025-11-06 10:22:30 | Status Change | Proposed | Agreed | User approved foundation rendering refactor for PBI 14. | user |
| 2025-11-06 10:23:00 | Status Change | Agreed | InProgress | Began implementation to render stacked foundation cards. | ai_agent |
| 2025-11-06 11:05:00 | Status Change | InProgress | Review | Implementation complete; awaiting integrated flight verification with demo run. | ai_agent |

## Requirements
- Render every foundation card instead of only the top card, keeping their measurement refs alive for ongoing animations.
- Maintain correct z-ordering so the top card visually appears in front while lower cards stay hidden beneath.
- Ensure celebration and auto-complete pipelines continue to access the same card instances without remounting.
- Preserve existing gesture handlers, hit targets, and wiggle triggers for manual interactions.

## Implementation Plan
1. Audit foundation rendering in `app/(tabs)/index.tsx` (or extracted components) to confirm only the top card is currently rendered.
2. Update the foundation pile component to map through the full stack, layering cards at identical positions (e.g., absolute layout with incremental z-index).
3. Share card properties (flight IDs, measurement refs, keys) with the existing card view so animations remain consistent.
4. Verify invalid-move wiggle logic only applies to the top card while lower cards remain inert.
5. Run through manual moves, auto-complete, and celebrations to ensure animations persist and no duplicate renders appear.

## Test Plan
- Manual: Move cards manually from tableau/waste to foundation and confirm flights remain visible for consecutive drops.
- Manual: Trigger auto-complete and observe that stacked flights animate correctly without wiggles.
- Manual: Start a celebration sequence and verify stacked foundation rendering still works.
- Command: `yarn demo:auto-solve` to validate automated runs and inspect dev logs for foundation flights.

## Verification
- `yarn tsc --noEmit` (ensured project compiles after foundation rendering changes).
- `yarn demo:auto-solve` (observed `[Flight] queue/dispatch/cache sync` logs for foundation moves with no stray wiggles throughout auto-complete).

## Files Modified
- `docs/delivery/14/14-1.md`
- `docs/delivery/14/tasks.md`
- `docs/delivery/backlog.md`
- `app/(tabs)/index.tsx` (expected)


