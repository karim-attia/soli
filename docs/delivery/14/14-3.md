# [14-3] Reuse foundation cards for celebration animation

[Back to task list](../tasks.md)

## Description
Adjust the celebration system so that it animates the already rendered foundation cards instead of spawning duplicates, ensuring the final king and preceding cards remain visible when the celebration begins.

## Status History
| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2025-11-06 14:10:00 | Created | N/A | Proposed | Drafted task to drive celebration animation from mounted foundation cards. | ai_agent |
| 2025-11-06 14:10:30 | Status Change | Proposed | Agreed | User confirmed scope to reuse foundation cards and keep the last king visible. | user |
| 2025-11-06 14:11:00 | Status Change | Agreed | InProgress | Started refactoring celebration bindings and visibility logic. | ai_agent |
| 2025-11-06 15:05:00 | Status Change | InProgress | Review | Celebration now animates foundation cards directly with logging and king visibility validated. | ai_agent |

## Requirements
- Drive all celebration motion using the foundation card components that remain mounted after game completion.
- Ensure the final king is rendered on the foundation immediately after arrival, even once celebration starts.
- Remove the duplicate celebration overlay so there are no simultaneous copies of the same card.
- Maintain developer logging for celebration start, progression, and completion including key metadata.
- Preserve user ability to tap/abort the celebration while keeping the board locked until it finishes or is aborted.

## Implementation Plan
1. Reintroduce celebration shared values (assignments, progress, mode, etc.) that map onto existing foundation cards.
2. Update `CardView` to apply celebration transforms when bindings are active while falling back to flight/wiggle behaviour otherwise.
3. Expose the celebration bindings to foundation piles and avoid hiding top cards once all cards are rendered.
4. Remove the standalone celebration overlay in favour of using the mounted cards, adding a simple touch blocker for abort behaviour.
5. Add targeted dev logs for celebration start, assignment setup, abort, and completion.

## Test Plan
- Manual: Finish a game and confirm the final king remains visible in the foundation during celebration.
- Manual: Observe that celebration animations move the real foundation cards (no duplicates) and that tapping abort ends the sequence gracefully.
- Command: `yarn demo:auto-solve` to validate celebration choreography and inspect celebration-related logs.
- Command: `yarn tsc --noEmit` to ensure TypeScript continues to compile after refactor.

## Verification
- `yarn tsc --noEmit`
- `yarn demo:auto-solve` (observed final king remain on foundation while the same card animates through celebration paths; console shows `[Celebration] start`, `[Celebration] complete`, and detailed flight logs.)

## Files Modified
- `docs/delivery/14/14-3.md` (this file)
- `docs/delivery/14/tasks.md`
- `app/(tabs)/index.tsx`
- `src/animation/flightController.ts`

