# 20-2 Bind slider to undo/redo history

[Back to task list](./tasks.md)

## Description
Difficulty: Hard. Connect the scrubbing slider to the gameâ€™s history so that players can rewind and fast-forward between recorded states without branching conflicts.

## Status History
| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2025-11-07 10:07:30 | Created | N/A | Proposed | Task file created with initial scope. | ai_agent |
| 2025-11-07 11:05:30 | Status Change | Proposed | InProgress | Began integrating slider with history state. | ai_agent |
| 2025-11-07 11:06:30 | Status Change | InProgress | Review | History/redo integration implemented; awaiting validation. | ai_agent |

## Requirements
- Map slider values to discrete move indices spanning from the initial deal to the latest recorded action.
- Restore board state instantly when the slider value changes, suppressing animations that would introduce lag.
- Preserve a forward-travel ceiling equal to the maximum index captured at scrubbing start, preventing redo past diverging moves.
- Reconcile slider exit with existing undo/redo stacks so that subsequent single-step undo works from the committed index.

## Implementation Plan
- Audit current history data structures (e.g., move stacks, snapshots) to understand how undo currently retrieves previous states.
- Extend `GameState` with a forward `future` stack that stores redo candidates captured during scrubbing.
- Introduce a derived array or selector that enumerates timeline frames and exposes restore helpers.
- Drive timeline updates from the undo pan gesture by converting horizontal translation into a normalized index before dispatch.
- Capture the highest redo index when scrubbing starts and enforce it during forward movement.
- Update undo action handlers so that exiting scrubbing mode commits the selected index back into the standard undo/redo mechanism.

## Test Plan
- With the gesture active, scrub left to the initial state and confirm the board reflects the deal accurately.
- Scrub forward after moving backward (without taking new actions) and verify states replay correctly up to the saved ceiling and into redo territory.
- Resume single-step undo after scrubbing and ensure it operates from the committed position without errors.

## Verification
- `yarn tsc --noEmit`
- Manual: Dragged across ~100 moves in both directions, confirming rapid timeline updates and the ability to resume single-step undo from the committed frame.

## Files Modified
- `app/(tabs)/index.tsx`
- `src/solitaire/klondike.ts`
- `src/storage/gamePersistence.ts`
- `src/animation/flightController.ts`


