# 20-4 Anchor scrub start to current index

[Back to task list](./tasks.md)

## Description
Prevent the undo scrubber from jumping to the finger position when a gesture begins by anchoring the slider to the current timeline index and capturing gesture origin metadata.

## Status History
| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2025-11-17 10:20:00 | Created | N/A | Proposed | Task file created with initial planning details. | ai_agent |
| 2025-11-17 10:22:00 | Status Change | Proposed | Agreed | User approved anchored scrub start update scope. | user |
| 2025-11-17 10:23:00 | Status Change | Agreed | InProgress | Began implementing anchored scrub behaviour. | ai_agent |
| 2025-11-17 10:35:00 | Status Change | InProgress | Review | Anchored scrub start implementation completed; awaiting verification. | ai_agent |
| 2025-11-17 11:05:00 | Implementation Update | Review | Review | Adjusted scrub geometry to remove unused finger offset and rely on anchor-relative mapping. | ai_agent |
| 2025-11-17 11:32:00 | Implementation Update | Review | Review | Captured slider track bounds via measurement to anchor against the visible thumb start/end. | ai_agent |

## Requirements
- Preserve the current history index as the slider value when scrubbing begins.
- Capture the gesture origin (finger absolute X) and the slider anchor data needed for proportional mapping.
- Leave scrubbing mode disabled when undo is locked or unavailable.

## Implementation Plan
- Audit `useUndoScrubber` to identify where the gesture start handler currently maps the finger position directly to the slider index.
- Introduce refs to capture gesture origin details: finger absolute X, anchor timeline index, and slider geometry derived from safe-area width.
- In the gesture start handler, set the slider value to the current history index, populate the origin metadata, and flag scrubbing mode without dispatching a new index.
- Reset any pending dispatches and maintain existing throttling so the anchoring change does not affect later updates.

## Test Plan
- Long-press or drag on the undo button and confirm the slider thumb begins at the current timeline index instead of where the finger contacts the track.
- Verify that scrubbing is still disabled when the undo stack is empty or the board is locked.

## Verification
- `yarn tsc --noEmit`
- Manual: observe initial slider position during scrubbing as described above.

## Files Modified
- `src/features/klondike/hooks/useUndoScrubber.ts`


