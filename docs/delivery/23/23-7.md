# 23-7 Remove manual handlers & streamline scrub logic

[Back to task list](../tasks.md)

## Description
Eliminate the legacy "handleManual" selection flows from the Klondike screen and centralize the undo scrubbing implementation so the orchestration lives in a single, testable module.

## Status History
| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2025-11-12 18:05:00 | Created | N/A | Proposed | Task defined based on follow-up cleanup requests. | ai_agent |
| 2025-11-12 18:12:00 | Status Change | Proposed | InProgress | Started removing manual handlers and extracting scrub logic. | ai_agent |
| 2025-11-12 18:28:00 | Status Change | InProgress | Review | Manual handlers removed and undo scrub hook integrated. | ai_agent |

## Requirements
- Remove the manual selection handlers (`handleManual...`) from `app/(tabs)/index.tsx` and any components/hooks that no longer need them.
- Revisit the undo scrubbing flow, extracting shared logic into a dedicated utility or hook if it improves reuse/readability.
- Ensure the removal does not regress gesture support for undo scrubbing or auto move behaviour.
- Update or remove any related tests, comments, or documentation.

## Implementation Plan
1. Audit all manual handler functions and identify the minimum set still required.
2. Delete or relocate redundant handlers, updating component props as needed.
3. Review undo scrubbing state/gesture logic and consolidate it into a module with clear responsibilities.
4. Smoke test scrubbing in the demo (`yarn demo:auto-solve`) to confirm behaviour is intact.

## Implementation Notes
- Deleted `handleManual*` flows from `app/(tabs)/index.tsx` and removed the associated long-press props across `TopRow`, `TableauSection`, `WasteFan`, `FoundationPile`, and `CardView`.
- Created `useUndoScrubber` to encapsulate the undo gesture orchestration and replaced the inline state/effect block in the screen with the hook.
- Updated the screen to consume the new hook output and cleaned up unused imports after the extraction.

## Test Plan
- `yarn tsc --noEmit`
- Manual: exercise undo scrubbing on device/simulator _(not yet run in this pass)_.

## Verification
- Manual selection flows no longer exist in the Klondike screen or its extracted card components.
- Undo scrubbing logic resides in `useUndoScrubber`, keeping the screen focused on wiring.
- TypeScript build passes after the refactor.

## Files Modified
- `app/(tabs)/index.tsx`
- `src/features/klondike/hooks/useUndoScrubber.ts`
- `src/features/klondike/components/cards/TopRow.tsx`
- `src/features/klondike/components/cards/TableauSection.tsx`
- `src/features/klondike/components/cards/WasteFan.tsx`
- `src/features/klondike/components/cards/FoundationPile.tsx`
- `src/features/klondike/components/cards/CardView.tsx`
