# 23-21 Audit container follow-ups

[Back to task list](../tasks.md)

## Status History
| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2025-11-12 21:10:00 | Created | N/A | Proposed | Task opened to review the freshly split container/view setup. | ai_agent |
| 2025-11-12 21:11:00 | Status Change | Proposed | InProgress | Started auditing useKlondikeGame and related files. | ai_agent |
| 2025-11-12 21:18:00 | Status Change | InProgress | Review | Cleanups completed per findings. | ai_agent |

## Scope
- Inspect `useKlondikeGame.ts`, `KlondikeGameView.tsx`, and supporting components for additional extraction or reintegration opportunities.
- Validate that card-flight/celebration animations still receive the necessary layout + selection metadata after the split.
- Capture actionable cleanups or follow-on tasks discovered during the review.

## Findings
1. **Animation handling remains correct**  
   - `collectSelectionCardIds` still feeds the flight controller, and the resolver now sits directly beside the hook state refs.  
   - Celebration bindings and layout callbacks (`handleTopRowLayout`, `handleFoundationLayout`) continue to flow through `viewProps` into the presentational layer. No reintegration needed.
2. **Statistics derivation lives in UI space**  
   - `buildStatisticsRowsForState` now handles elapsed time formatting. The container simply asks for rows, which matches the UI-only intent.  
   - However, the current `useMemo` depends on the entire `state` object, causing needless recalculation on unrelated reducer changes.
3. **Minor cleanup**  
   - `CardFlightSnapshot` is still imported in `useKlondikeGame.ts` but no longer referenced after the splitâ€”safe to drop.  
   - `viewProps` creation already uses stable callbacks, so no further extraction needed immediately.

## Planned Adjustments
- Narrow the statistics `useMemo` dependencies to the specific pieces of state it actually uses (elapsed + move count), reducing churn.
- Remove the unused `CardFlightSnapshot` type import from `useKlondikeGame.ts`.

## Actions Taken
- Updated `buildStatisticsRows` to accept explicit timer/move inputs and adjusted the container's dependency array accordingly.
- Dropped the unused `CardFlightSnapshot` import.

## Follow-ups
- Consider future micro-hooks (`useTopRowViewModel`, `useTableauViewModel`) if the container grows again, but no immediate action required after this cleanup.


