# 23-3 Modularise card and pile components

[Back to task list](../tasks.md)

## Description
Extract card, waste, foundation, tableau, and related rendering logic into reusable modules under the Klondike feature namespace while preserving animation bindings and styling.

## Status History
| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2025-11-12 13:13:00 | Created | N/A | Proposed | Task documented per refactor analysis. | ai_agent |
| 2025-11-12 14:20:00 | Status Change | Proposed | InProgress | Began modularising card and pile components into feature modules. | ai_agent |
| 2025-11-12 15:25:00 | Status Change | InProgress | Review | Extracted card UI into feature module and rewired screen; TypeScript checks pass. | ai_agent |

## Requirements
- Move `CardView`, `WasteFan`, `FoundationPile`, `TableauColumn`, and supporting components into `src/features/klondike/components/cards`.
- Preserve Reanimated bindings by exposing explicit props for flight snapshots, invalid wiggle, and celebration bindings.
- Consolidate card-related constants (colours, sizes, animation timings) into a shared constants module consumed by the new components.
- Provide index exports to simplify consumption from the Klondike screen and other modules.

## Implementation Plan
1. Create `src/features/klondike/components/cards` and relocate card-related JSX and styles from `app/(tabs)/index.tsx`.
2. Abstract shared constants (e.g., suit symbols, colour palette, animation durations) into `src/features/klondike/constants.ts` or a dedicated cards constants file.
3. Add TypeScript interfaces for component props, ensuring all animation-related dependencies are documented.
4. Update the Klondike screen to import components from the new location, passing through existing references and memoised data.
5. Add comments where card components are invoked to explain their responsibilities and animation expectations.

## Implementation Notes
- Added `src/features/klondike/components/cards/index.tsx` exporting `TopRow`, `TableauSection`, `CelebrationTouchBlocker`, and shared helpers with the original animation logic and styles.
- Centralised card metrics, colours, animation timings, and wiggle constants in `src/features/klondike/constants.ts`, and introduced shared types (`CardMetrics`, `InvalidWiggleConfig`, `CelebrationBindings`) in `src/features/klondike/types.ts`.
- Rewired `app/(tabs)/index.tsx` to consume the new components, replacing inline definitions with imports and descriptive comments.
- Simplified the screen styles to retain only layout and celebration badge styling.
- Removed the old foundation wiggle suppression bookkeeping per user request, keeping only logging for arrivals.

## Test Plan
- `yarn tsc --noEmit`

## Verification
- TypeScript compilation succeeds (`yarn tsc --noEmit`).
- Manual review of the Klondike screen confirms top-row/tableau components render through the new module, and invalid move wiggle still fires via the shared props.

## Files Modified
- `app/(tabs)/index.tsx`
- `src/features/klondike/constants.ts`
- `src/features/klondike/types.ts`
- `src/features/klondike/components/cards/index.tsx`
- `docs/delivery/23/23-3.md`
