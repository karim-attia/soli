# 23-5 Integrate refactored structure

[Back to task list](../tasks.md)

## Description
Recompose the Klondike screen using the extracted modules and hooks, ensuring wiring is clean, documented, and aligned with the new architecture.

## Status History
| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2025-11-12 13:15:00 | Created | N/A | Proposed | Task documented per refactor analysis. | ai_agent |
| 2025-11-12 16:40:00 | Status Change | Proposed | InProgress | Began integrating extracted components and hooks into the Klondike screen. | ai_agent |
| 2025-11-12 17:10:00 | Status Change | InProgress | Review | Completed integration cleanup, comments, and typechecks. | ai_agent |

## Requirements
- Update `app/(tabs)/index.tsx` to focus on orchestrating state, passing props to extracted components, and coordinating reducers and controllers.
- Replace inline component definitions with imports from `src/features/klondike` modules.
- Add descriptive comments above new component invocations and hook usages per the user request.
- Ensure TypeScript types remain accurate and there are no unused exports.

## Implementation Plan
1. Remove inlined component definitions from the screen file, replacing them with imports from tasks 23-2 through 23-4 outputs.
2. Wire extracted hooks, ensuring dependencies are memoised as needed to avoid unnecessary renders.
3. Add explanatory comments above each major component or hook call to describe its role.
4. Validate bundler paths and Expo configuration for the new directories.

## Implementation Notes
- Collapsed all residual celebration/timer/persistence implementations in `app/(tabs)/index.tsx`, delegating to the new hooks and reusing the shared refs provided to them.
- Added call-site comments for the extracted hooks and major layout sections (felt background, top row, tableau, undo scrubber) to satisfy the documentation requirement.
- Removed obsolete imports, duplicate refs, and inline celebration logic that migrated to `useCelebrationController`.
- Cleaned up `useCelebrationController` to import only the constants it requires and accept the `requestNewGame` ref so dialogs can be triggered without circular dependencies.
- Split the former `components/cards/index.tsx` into focused modules (`TopRow`, `TableauSection`, `CardView`, etc.) with a shared `styles.ts` barrel, keeping a slim `index.ts` for external exports.
- Centralised Reanimated logic into `animations.ts` hooks (`useCardAnimations`, `useWasteFanCardAnimation`, `useFoundationGlowAnimation`) so rendering files only orchestrate layout and props.

## Test Plan
- `yarn tsc --noEmit`

## Verification
- TypeScript compilation passes after the integration adjustments.
- Manual sanity review of the JSX confirms the screen now composes extracted modules with clear responsibilities and comments.

## Files Modified
- `app/(tabs)/index.tsx`
- `src/features/klondike/hooks/useCelebrationController.ts`
- `docs/delivery/23/23-5.md`

