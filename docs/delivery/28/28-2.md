[Back to task list](./tasks.md)

# [28-2] Speed up auto-up cadence + keep flights reliable

## Description
Increase auto-up (auto-complete) speed substantially by lowering the auto-queue delays, and ensure that at higher cadence, card-flight animations remain reliable (especially stock→waste draws which otherwise have no `Selection` context).

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
| :-- | :-- | :-- | :-- | :-- | :-- |
| 2025-12-14 12:45:00 | Created | N/A | Proposed | Task created to make auto-up much faster while keeping flights reliable. | ai_agent |
| 2025-12-14 12:46:00 | Status Change | Proposed | Agreed | User requested much faster auto-up and asked to ensure animation reliability first. | user |
| 2025-12-14 12:52:00 | Status Change | Agreed | InProgress | Started implementing faster auto-up cadence and draw-step snapshot gating. | ai_agent |
| 2025-12-14 13:05:00 | Status Change | InProgress | Review | Reduced auto-up delays and added snapshot gating for auto-queue draw/recycle steps. | ai_agent |
| 2025-12-14 13:25:00 | Status Change | Review | InProgress | Reopened: auto-up still perceived slow; implement batching (multi-advance per tick) and re-verify timer behavior on-device. | ai_agent |
| 2025-12-14 13:35:00 | Status Change | InProgress | Review | Implemented multi-advance batching in reducer so auto-up progresses multiple actions per tick. | ai_agent |

## Requirements
- Reduce auto-queue delay values so auto-up runs much faster.
- Ensure auto-queue draw steps (stock→waste) remain snapshot-gated so the drawn card’s flight uses the correct origin.
- Keep the change scoped to auto-up; do not speed up manual interactions.

## Implementation Plan
1. Add auto-up timing constants and wire them into `useAutoQueueRunner` from `useKlondikeGame`.
2. Ensure `dispatchWithFlight` snapshot-gates `ADVANCE_AUTO_QUEUE` draw steps by inferring the affected card id.
3. Validate the sequence via manual play and demo auto-solve.

## Test Plan
- Manual:
  - Trigger auto-up and verify it completes substantially faster.
  - Watch for bogus “off-screen” draw flights during auto-up.
- Dev:
  - Run `yarn demo:auto-solve` and observe cadence/visual coherence.

## Verification
- Code: Auto-queue cadence increased via reduced delays in `useKlondikeGame`.
- Code: `ADVANCE_AUTO_QUEUE` draw/recycle steps now infer card IDs for snapshot gating (prevents off-screen stock→waste origins).
- Code: `ADVANCE_AUTO_QUEUE` now consumes multiple queued actions per tick so multiple flights can animate concurrently (dramatic speed-up).
- Note: Typecheck could not be run in this worktree due to an existing lockfile/workspace mismatch (unrelated to this change).

## Files Modified
- `docs/delivery/28/tasks.md`
- `docs/delivery/28/28-2.md`
- `src/features/klondike/hooks/useKlondikeGame.ts`
- `src/solitaire/klondike.ts`
