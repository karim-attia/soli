# [1-3] Wire controls, draw-1 cycling, undo UX

[Back to task list](../tasks.md)

## Description
Hook the reducer into top-level controls for drawing cards, cycling the stock, creating a new shuffled game, and exposing an Undo action with disabled states and user feedback.

## Status History
| Timestamp | Event Type | From Status | To Status | Details | User |
| :-- | :-- | :-- | :-- | :-- | :-- |
| 2025-10-26 13:17:00 | Created | N/A | Proposed | Task stubbed. | ai_agent |
| 2025-10-26 13:19:30 | user_approves | Proposed | Agreed | Confirmed requirement for draw-1 & undo UX. | user |
| 2025-10-26 13:55:00 | start_work | Agreed | InProgress | Hooked up controls/toasts + undo wiring. | ai_agent |
| 2025-10-26 14:05:00 | submit_for_review | InProgress | Review | Controls + undo/draw/new game finalized. | ai_agent |
| 2025-10-26 14:10:00 | approve | Review | Done | Task implementation approved by user. | user |

## Requirements
- Display Draw, Undo, and New Game controls with Tamagui Buttons that call reducer actions.
- Disable Draw when stock is empty and waste cannot be recycled; disable Undo when no history exists.
- Provide textual feedback/toast for invalid actions if needed (reuse existing Toast provider if helpful).
- Ensure undo restores prior card orientations and selection states.

## Implementation Plan
1. Extend reducer with explicit actions for draw, recycle stock when empty, new game, undo, and selection reset.
2. Create a bottom control bar with Tamagui Buttons + iconography that call dispatchers.
3. Maintain a history stack (bounded by constant) and use it when Undo triggers, resetting `selected` state.
4. Add optional toast/snackbar for invalid moves or when actions disabled, leveraging `ToastControl` if necessary.

## Test Plan
- Manual: play through a sequence (draw, move card, draw) then tap Undo multiple times to confirm state rewinds correctly.
- Manual: empty stock entirely, ensure draw button text changes to “Recycle” (or similar) and recycling repopulates stock from waste face-down.
- Manual: start new game, ensure board resets and undo history clears.

## Verification
- Conducted a reducer + UI handler walkthrough covering draw, recycle, undo, and new game flows to ensure button disabled states and toast copy align with the latest requirements.
- `yarn tsc --noEmit` and `npx expo export --platform web --output-dir dist-web` both succeed, covering static type safety plus build output for the new controls layer.

## Files Modified
- `src/solitaire/klondike.ts`
- `app/(tabs)/index.tsx`
