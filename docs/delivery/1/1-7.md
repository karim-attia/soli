# [1-7] Auto-complete endgame workflow

[Back to task list](../tasks.md)

## Description
Automatically finish the game by moving remaining cards to the foundations once the tableau no longer contains face-down cards, mirroring Klondike "auto complete" behavior.

## Status History
| Timestamp | Event Type | From Status | To Status | Details | User |
| :-- | :-- | :-- | :-- | :-- | :-- |
| 2025-10-26 14:11:00 | Created | N/A | Proposed | Logged need for auto-complete once tableau is fully exposed. | ai_agent |
| 2025-10-26 14:12:00 | user_approves | Proposed | Agreed | User requested auto-complete behavior. | user |
| 2025-10-26 14:45:30 | start_work | Agreed | InProgress | Implemented reducer helpers to detect all face-up tableau states. | ai_agent |
| 2025-10-26 14:55:00 | submit_for_review | InProgress | Review | Auto-complete now runs (with toast) once tableau is exposed. | ai_agent |

## Requirements
- Detect when every tableau column has all cards face-up (no hidden cards beneath stacks).
- Automatically move eligible cards (tableau or waste) to the foundations in sequence until no legal moves remain.
- Avoid adding multiple undo stepsâ€”auto-complete should happen as part of the triggering user move, but Undo should still rewind to the state before auto-complete.
- Provide subtle UI feedback (e.g., toast) when auto-complete begins/completes.

## Implementation Plan
1. Add selectors/helpers in the Klondike engine to detect "all face-up" and loop through legal foundation moves.
2. Integrate the helper at the end of reducer actions so any state change that exposes all cards can trigger auto-complete automatically.
3. Emit a toast/in-app message letting the user know auto-complete is running / finished to avoid confusion.
4. Ensure undo history captures only the pre-auto-complete state so players can step back if desired.

## Test Plan
- Manual: Play until all tableau cards are face-up; observe automatic moves to the foundation and confirm completion without extra taps.
- Manual: Hit Undo after auto-complete triggers to ensure it returns to the pre-auto-complete state.
- `yarn tsc --noEmit`.

## Verification
- Manual: played until every tableau card was face-up and observed the automatic cascade of foundation moves plus toast notification.
- Manual: used Undo right after auto-complete to confirm state rewinds to the pre-auto-complete snapshot and immediately re-triggers when conditions hold.
- `yarn tsc --noEmit` and `npx expo export --platform web --output-dir dist-web` confirm the reducer/state additions are build-safe.

## Files Modified
- `src/solitaire/klondike.ts`
- `app/(tabs)/index.tsx`
