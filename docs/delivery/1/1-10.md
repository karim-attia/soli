# 1-10 Atomic flip solver + toggle

[Back to task list](../tasks.md)

## Description
Implement a flip-centric Klondike solver where an "atomic position" is the moment immediately after a face-down tableau card is flipped. From each atomic position, run a shortest-path search to reach the next flip, collect all candidate next flips with minimal step counts ("approaches"), select the least-steps approach (with domain-aware tiebreaks), advance to its atomic position, and repeat with backtracking when stuck. Add a flagged toggle in `src/solitaire/klondike_solver.js` to choose between the existing DFS solver and the new atomic solver.

## Status History
| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2025-10-26 20:25:00 | Status Change | Proposed | InProgress | Created task and started implementation planning. | ai-agent |
| 2025-11-01 11:46:00 | Status Change | InProgress | Review | Atomic solver implemented with strategy toggle wired through CLI harness. | ai-agent |

## Requirements
- Implement new solver at `src/solitaire/klondike_solver_atomic.js`.
- Maintain current rule model: draw-1, unlimited recycles; treat stock as unordered availability.
- Atomic-step search: BFS-to-first-flip per atomic state; collect minimal-step approaches; greedy-by-steps with backtracking.
- Transposition table (Zobrist) for states; budgets per layer and global.
- Export API compatible with existing solver: `solveKlondike(deckOrder, options) -> { solvable, difficulty?, stats }`.
- Add toggle flag in `src/solitaire/klondike_solver.js` options (e.g., `options.strategy: 'dfs'|'atomic'`).

## Implementation Plan
- Define atomic state detector (immediately after any flip).
- Implement local BFS from atomic state to reach any next flip; record minimal steps and path.
- Candidate ranking: steps asc, then prefer moves that open columns, are safe-to-foundation, or expose larger hidden runs.
- Depth-first over atomic layers with backtracking across candidates; apply/undo in-place; reuse Zobrist hashing.
- Difficulty classification by nodes and flips depth.

## Verification
- `node scripts/solve-klondike.js --trials=5 --strategy=atomic` — solver executes with blended ranking; outputs include `atomicTried`/`atomicDead` counters and completes within configured budgets.
- `node scripts/solve-klondike.js --trials=5 --strategy=dfs` — regression check to ensure DFS path still operates when atomic implementation present.
- `node scripts/solve-klondike.js --strategy=atomic --compareAtomicVariants=true` — execution initiated; workload across 100 decks exceeded 180s timeout (command terminated by harness). CLI logging validated option plumbing; further optimization/new timeout may be required for full report generation.

## Files Modified
- `src/solitaire/klondike_solver_atomic.js` (new)
- `src/solitaire/klondike_solver.js` (edit: strategy toggle)
- `docs/delivery/1/tasks.md` (added task)
