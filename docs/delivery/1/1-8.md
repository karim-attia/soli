# [1-8] Board column spacing + aligned top row

[Back to task list](../tasks.md)

## Description
Update Klondike board layout so cards are larger on-screen by halving column gaps, setting board edge gutters to one column gap (safe-area aware), and aligning the top row (foundations + stock/waste) to the same 7-column grid as the tableau.

## Status History
| Timestamp | Event Type | From Status | To Status | Details | User |
| :-- | :-- | :-- | :-- | :-- | :-- |
| 2025-12-14 00:00:00 | Created | N/A | Proposed | Logged request to resize card grid and align top row to columns. | ai_agent |
| 2025-12-14 00:00:01 | user_approves | Proposed | Agreed | User requested updated spacing + alignment behavior. | user |
| 2025-12-14 00:00:02 | start_work | Agreed | InProgress | Started implementing new card-width formula, board gutters, and top-row alignment. | ai_agent |
| 2025-12-14 00:15:00 | submit_for_review | InProgress | Review | Implemented 7-gap card sizing, half column gaps, safe-area board gutters, and top-row column alignment without changing header/undo spacing. | ai_agent |
| 2025-12-14 19:17:57 | significant_update | Review | InProgress | User feedback: increase board edge spacing to match column gap; ensure foundation/slot outlines align exactly with cards and disappear behind cards. | ai_agent |
| 2025-12-14 19:20:20 | submit_for_review | InProgress | Review | Updated edge gutters to equal column gap and removed foundation outline inset so cards sit flush on piles. | ai_agent |

## Requirements
- Halve the **gap between tableau columns** compared to today.
- Reduce **board edge gutters** so the total spacing to the screen edge is **the column gap** (safe-area aware).
- Update the card sizing calculation so:
  - \(7\times cardWidth + 6\times gap + 2\times gap = availableWidth\)
  - i.e. \(availableWidth - 8\times gap = 7\times cardWidth\)
- Align the **foundations** to the **first 4 columns** using the same spacing as the tableau columns.
- Align the **draw/stock stack** to the **last column** (and keep waste aligned on the same column grid).
- Do **not** change spacing for non-board UI (statistics HUD, undo button/scrubber, drawer, etc.).
- Fix top-row pile alignment so stash/waste/stock cards are **100% horizontally aligned** with the tableau grid even if the numeric labels below are wider.
- Ensure foundation/slot outlines match card dimensions and do not remain visible behind cards (no inset/offset).

## Implementation Plan
1. Introduce board-specific spacing constants so board gaps can change without altering header/undo spacing.
2. Update `computeCardMetrics()` to use the new \(8\) gap-count formula and the reduced column gap.
3. Update tableau and top-row layouts to use the same 7-column grid (card width + half-gap margins) and safe-area aware edge gutters.
4. Ensure pile buttons (waste/stock) do not shift due to their numeric labels.

## Test Plan
- Manual: Verify on at least one small and one large device/simulator that:
  - Column gaps are ~half of before.
  - Cards sit closer to the screen edge and edge spacing equals the column gap (within safe area).
  - Foundations align to tableau columns 1–4 and stock aligns to column 7.
  - Header statistics and undo UI retain the same edge spacing as before.
- `yarn tsc --noEmit`.

## Verification
- Manual: verify column gaps are ~half, edge gutter is one gap (safe-area aware), foundations align to columns 1–4, and stock aligns to column 7.
- Note: `yarn tsc --noEmit` is currently failing due to pre-existing TypeScript errors outside the Klondike feature; no new lints in the files touched for this task.

## Files Modified
- `src/features/klondike/constants.ts`
- `src/features/klondike/utils/cardMetrics.ts`
- `src/features/klondike/hooks/useKlondikeGame.ts`
- `src/features/klondike/components/KlondikeGameView.tsx`
- `src/features/klondike/components/cards/styles.ts`
- `src/features/klondike/components/cards/TableauSection.tsx`
- `src/features/klondike/components/cards/TopRow.tsx`
- `src/features/klondike/components/cards/PileButton.tsx`
