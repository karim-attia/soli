# [6-2] Lock gameplay during celebrations

[Back to task list](../tasks.md)

## Description
Prevent further interactions with the board once the final card reaches a foundation and celebrations begin, re-enabling input only after the sequence completes.

## Status History
| Timestamp | Event Type | From Status | To Status | Details | User |
| :-- | :-- | :-- | :-- | :-- | :-- |
| 2025-11-01 09:29:00 | Created | N/A | Proposed | Task added to disable gameplay during win celebrations. | ai_agent |
| 2025-11-01 09:59:45 | user_approves | Proposed | Agreed | User approved gameplay lock task. | user |

## Requirements
- Detect the transition into the win state and prevent further user moves.
- Allow undo/new game actions only after celebrations finish or if interrupted (if allowed).
- Ensure auto-play cannot restart once the celebratory lock is active.

## Implementation Plan
1. Extend game state with a `celebrationActive` flag set when the last foundation fills.
2. Gate move handlers, draw actions, and other inputs behind this flag.
3. Provide a clear path to reset the flag when celebrations end or a new game starts.
4. Update reducers/selectors to respect the locked state without breaking undo stack integrity.
5. Add regression coverage ensuring normal play remains unaffected until the win trigger occurs.

## Test Plan
- Manual: Complete a game and attempt to interact with tableau/waste during celebration; interactions should be disabled.
- Manual: After celebration ends, confirm interactions resume once a new game is started.
- `yarn test --watch=false` (add coverage for locked-state guards).
- `yarn tsc --noEmit`.

## Verification
- Manual verification across platforms confirming inputs are blocked during celebration.
- `yarn tsc --noEmit`.

## Files Modified
- `app/(tabs)/index.tsx`
- `src/solitaire/klondike.ts`

